<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üê∏ Toadgod Lore Library</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #f5f5ef;
      color: #222;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 18px;
      background: #fff;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
      position: sticky;
      top: 0;
      z-index: 10;
      flex-wrap: wrap;
      gap: 10px;
    }
    header h1 {
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 0.4em;
      margin: 0;
    }
    header .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    button, .badge {
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    button:hover { opacity: 0.9; }
    .badge {
      background: #eee;
      font-weight: bold;
    }
    .badge.viewer { background: #f2e1b9; }
    .badge.admin { background: #c6f6c6; }
    main {
      display: grid;
      grid-template-columns: 260px 1fr;
      gap: 16px;
      padding: 16px;
    }
    main.single {
      grid-template-columns: 1fr;
    }
    .toc {
      background: #fff;
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .content {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    article.scroll {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      padding: 16px;
    }
    .twocol {
      display: grid;
      grid-template-columns: 42% 58%;
      gap: 14px;
    }
    .panel {
      background: #fafafa;
      padding: 12px;
      border-radius: 6px;
    }
    .panel h3 { margin-top: 0; }
    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }
    .tag {
      background: #e0e0e0;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
    }
    footer {
      text-align: center;
      padding: 20px;
      font-size: 0.9rem;
      color: #666;
    }
    footer strong { color: #355e3b; }
    /* desktop layout */
    @media (min-width: 1100px) {
      main.single .content,
      main.single .toc {
        max-width: 980px;
        margin: 0 auto;
      }
      .twocol { gap: 22px; }
    }
    @media (min-width: 1400px) {
      main.single .content,
      main.single .toc {
        max-width: 1040px;
      }
      .twocol {
        grid-template-columns: 40% 60%;
        gap: 24px;
      }
    }
    /* form modal */
    #entryForm {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      max-width: 400px;
      width: 90%;
      display: none;
      flex-direction: column;
      gap: 10px;
      z-index: 100;
    }
    #entryForm label { font-size: 0.85rem; font-weight: bold; }
    #entryForm input, #entryForm textarea {
      width: 100%;
      padding: 6px;
      font-family: monospace;
    }
    #entryForm textarea { height: 80px; }
    #markdownHelp {
      font-size: 0.8rem;
      background: #fafafa;
      border: 1px solid #ccc;
      padding: 8px;
      border-radius: 6px;
      display: none;
      white-space: pre-wrap;
    }
    .help-toggle {
      cursor: pointer;
      font-size: 0.85rem;
      color: #b22;
      border: none;
      background: none;
      text-align: left;
    }
  </style>
</head>
<body>

<header>
  <h1>üê∏ Toadgod Lore Library</h1>
  <div class="controls">
    <span id="modeBadge" class="badge viewer">üîí Viewer Mode</span>
    <button onclick="toggleComments()">Toggle Commentary</button>
    <button onclick="changeFont(1)">A+</button>
    <button onclick="changeFont(-1)">A-</button>
    <button onclick="exportJSON()">Export JSON</button>
    <button id="adminBtn" onclick="toggleAdmin()">Enter Admin</button>
  </div>
</header>

<main>
  <div class="toc">
    <input id="search" placeholder="Search text, tags, dates‚Ä¶" style="width:100%;padding:6px;">
    <div id="chapters"></div>
  </div>
  <div class="content" id="content"></div>
</main>

<!-- Entry Form Modal -->
<div id="entryForm">
  <button onclick="closeForm()" style="align-self:flex-end">‚úñ Close</button>
  <button onclick="exportJSON()">‚¨á Export as data.json</button>
  <label>ID <input id="fid" placeholder="TOBY_T002 or TOBY_L001"></label>
  <label>Date <input id="fdate" type="date"></label>
  <label>Title <input id="ftitle"></label>
  <label>Original Lore (Markdown) <textarea id="foriginal"></textarea></label>
  <label>Commentary (Markdown) <textarea id="fcomment"></textarea></label>
  <label>Tags (comma) <input id="ftags"></label>
  <label>Tweet URL <input id="furl"></label>
  <label>Image URL <input id="fimg"></label>
  <div>
    <button class="help-toggle" onclick="toggleHelp()">‚ùì Markdown help</button>
    <div id="markdownHelp">
# Heading  
**bold** / *italic*  
- list item  
[Link](https://x.com/)  

### ‚ú® Literal Explanation  
### üå± Spiritual Interpretation  
### üîÆ Symbolic Meaning
    </div>
  </div>
  <button onclick="addEntry()">Add Entry</button>
  <button onclick="resetForm()">Reset</button>
</div>

<footer>
  ¬© Toadgod Lore ¬∑ Preserved by <strong>ToadAid</strong> üê∏<br>
  Original tweets preserved for study; commentary provided for learning and reflection.
</footer>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
let data=[]; let isAdmin=false; let showComments=true; let fontSize=1;

function $(q){return document.querySelector(q)}
function $$(q){return document.querySelectorAll(q)}

async function loadData(){
  try {
    const r=await fetch('data.json');
    data=await r.json();
  } catch(e){
    console.warn("No data.json yet, starting empty");
    data=[];
  }
}
function paint(){
  const q=$("#search").value.toLowerCase();
  const c=$("#content"); c.innerHTML="";
  data.forEach((e,i)=>{
    if(q && !JSON.stringify(e).toLowerCase().includes(q)) return;
    const art=document.createElement("article"); art.className="scroll";
    const grid=document.createElement("div"); grid.className="twocol";
    const left=document.createElement("div"); left.className="panel";
    const right=document.createElement("div"); right.className="panel commentary";
    left.innerHTML=`<h3>Original Lore</h3><div>${marked.parse(e.original||"")}</div>`;
    if(showComments){
      right.innerHTML=`<h3>Commentary</h3><div>${marked.parse(e.comment||"")}</div>`;
    }
    grid.append(left,right); art.append(grid);
    const meta=document.createElement("div");
    meta.className="tags";
    if(e.tags) e.tags.split(",").forEach(t=> meta.innerHTML+=`<span class=tag>${t.trim()}</span>`);
    if(e.url) meta.innerHTML+=`<a href="${e.url}" target="_blank">üîó Original Tweet</a>`;
    art.append(meta);
    if(isAdmin){
      const btns=document.createElement("div");
      btns.innerHTML=`<button onclick="editEntry(${i})">Edit</button>
                      <button onclick="delEntry(${i})">Delete</button>`;
      art.append(btns);
    }
    c.append(art);
  });
}
function toggleComments(){ showComments=!showComments; paint(); }
function changeFont(d){ fontSize+=d; document.body.style.fontSize=fontSize+"em"; }
function exportJSON(){
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob); a.download="data.json"; a.click();
}
function toggleAdmin(){
  if(!isAdmin){
    const pass=prompt("Enter passphrase:");
    if(pass==="TOADLOCK"){isAdmin=true;}
    else {alert("Incorrect passphrase."); return;}
  } else {isAdmin=false;}
  applyAdminUI();
}
function applyAdminUI(){
  $("#adminBtn").innerText=isAdmin?"Exit Admin":"Enter Admin";
  updateModeBadge(); setLayoutMode();
  paint();
}
function updateModeBadge(){
  const b=$("#modeBadge");
  b.className="badge "+(isAdmin?"admin":"viewer");
  b.textContent=isAdmin?"üîë Admin Mode":"üîí Viewer Mode";
}
function setLayoutMode(){
  document.querySelector("main").classList.toggle("single",!isAdmin);
}
function openForm(){ $("#entryForm").style.display="flex"; }
function closeForm(){ $("#entryForm").style.display="none"; }
function resetForm(){ $("#fid").value=$("#fdate").value=$("#ftitle").value=$("#foriginal").value=$("#fcomment").value=$("#ftags").value=$("#furl").value=$("#fimg").value=""; }
function toggleHelp(){ $("#markdownHelp").style.display= $("#markdownHelp").style.display==="block"?"none":"block"; }
function addEntry(){
  const e={
    id:$("#fid").value, date:$("#fdate").value, title:$("#ftitle").value,
    original:$("#foriginal").value, comment:$("#fcomment").value,
    tags:$("#ftags").value, url:$("#furl").value, img:$("#fimg").value
  };
  data.push(e); closeForm(); paint();
}
function editEntry(i){
  const e=data[i];
  $("#fid").value=e.id; $("#fdate").value=e.date; $("#ftitle").value=e.title;
  $("#foriginal").value=e.original; $("#fcomment").value=e.comment;
  $("#ftags").value=e.tags; $("#furl").value=e.url; $("#fimg").value=e.img;
  $("#entryForm").style.display="flex";
}
function delEntry(i){ if(confirm("Delete?")){data.splice(i,1); paint();} }

$("#search").oninput=paint;
(async()=>{ await loadData(); paint(); setLayoutMode(); })();
</script>
</body>
</html>
