<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ToadAid Contributors</title>
<meta name="description" content="Explore unique art contributed by Toadgang members worldwide. Every piece is part of the ToadAid legacy.">

<!-- Open Graph -->
<meta property="og:title" content="ToadAid — Contributor Art Vault" />
<meta property="og:description" content="Explore unique art contributed by Toadgang members worldwide. Every piece is part of the ToadAid legacy." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://toadaid.github.io/Contributors/" />
<meta property="og:image" content="https://toadaid.github.io/assets/icons/web-app-manifest-512x512.png" />

<!-- Canonical -->
<link rel="canonical" href="https://toadaid.github.io/Contributors/" />

<!-- Favicons -->
<link rel="icon" type="image/x-icon" href="/assets/icons/favicon.ico">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
<link rel="icon" type="image/svg+xml" href="/assets/icons/favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png">
<link rel="manifest" href="/assets/icons/site.webmanifest">
<meta name="theme-color" content="#355e3b" />

<style>
  :root{ --bg:#f5f1e6; --ink:#2f2f2f; --leaf:#355e3b; --gold:#d9b200; --card:#fff; }
  *{ box-sizing:border-box }
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family:'Segoe UI', system-ui, -apple-system, Arial, sans-serif;
    text-align:center; padding:20px;
  }
  h1{
    color:var(--leaf); font-size:2rem; position:relative; display:inline-block; padding-bottom:6px; margin:0;
  }
  h1::after{
    content:""; position:absolute; left:0; bottom:0; height:4px; width:100%;
    background:var(--gold); border-radius:2px;
  }
  .grid{
    display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap:16px; margin:20px auto 0; max-width:1200px; padding:0 6px;
  }
  .card{
    background:var(--card); border-radius:16px; padding:12px; text-align:left;
    box-shadow:0 8px 24px rgba(0,0,0,.08);
    border-left:6px solid var(--gold);
    transition: transform .15s ease, box-shadow .15s ease;
  }
  .card:hover{ transform:translateY(-3px); box-shadow:0 10px 28px rgba(0,0,0,.12) }
  .media{
    width:100%; background:#eee; border-radius:12px; overflow:hidden; border:1px solid #eee;
  }
  .media img, .media video{
    display:block; width:100%; height:auto;
    max-height:80vh;
    transition:opacity .35s ease;
    opacity:0;
  }
  .reveal{ opacity:1 !important }
  .meta{ margin:10px 0 4px; color:#425a47; font-size:.95rem }
  .title{ margin:0 0 6px; font-weight:700 }
  .desc{ margin:6px 0 10px; line-height:1.45 }
  .row{ display:flex; align-items:center; gap:8px; flex-wrap:wrap }
  .chip{ font-size:.8rem; background:#f0ead4; border:1px solid #e2d9b3; border-radius:999px; padding:4px 8px }
  .spacer{ flex:1 }
  .btn{ border:1px solid #d9d9d9; background:#fff; border-radius:10px; padding:8px 10px; cursor:pointer; }
  .btn:hover{ background:#f7f7f7 }
  a{ color:var(--leaf); text-decoration:none }
  a:hover{ text-decoration:underline }
  footer{ margin-top:46px; color:var(--leaf); font-size:.9rem }
  .lightbox{
    position:fixed; inset:0; background:rgba(0,0,0,.8);
    display:none; align-items:center; justify-content:center; z-index:50; padding:16px;
  }
  .lightbox.open{ display:flex }
  .lightbox .content > img, .lightbox .content > video{
    max-width:min(96vw,1200px); max-height:90vh; object-fit:contain; border-radius:12px; background:#000;
  }
  .lightbox .close{
    position:absolute; top:12px; right:12px; background:#000; color:#fff;
    border:1px solid #333; border-radius:10px; padding:8px 10px; cursor:pointer;
  }
</style>
</head>
<body>

<h1>ToadAid Contributor Art</h1>

<div id="contributors" class="grid" aria-live="polite"></div>

<footer>© 2025 ToadAid — Built by the people, for the people.</footer>

<!-- Lightbox -->
<div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="Media preview">
  <button class="close" aria-label="Close preview">✕</button>
  <div class="content" id="lightboxContent"></div>
</div>

<script>
const PLACEHOLDER = 'https://via.placeholder.com/1200x800?text=ToadAid';
const grid = document.getElementById('contributors');

function getSlug(c){
  const base = (c.file||'').split('/').pop().replace(/\.[^/.]+$/, '');
  const raw  = (c.title ? `${c.title}-${base}` : base) || 'item';
  return raw.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'');
}
function buildItemUrl(slug){
  const u = new URL(location.href);
  u.searchParams.set('item', slug);
  return u.toString();
}

let revealObserver, ioPlay;
function initObservers(){
  revealObserver = new IntersectionObserver((entries)=>{
    entries.forEach(e=>{
      if(e.isIntersecting){
        e.target.classList.add('reveal');
        revealObserver.unobserve(e.target);
      }
    });
  }, {threshold:.2});
  ioPlay = new IntersectionObserver((entries)=>{
    entries.forEach(entry=>{
      const v = entry.target;
      if(entry.isIntersecting){ ensureAutoplay(v); }
      else{ try{ v.pause(); }catch(_){ } }
    });
  }, {threshold:.4});
}

async function loadContributors(){
  try{
    const res = await fetch('./contributors.json?v='+Date.now());
    let contributors = await res.json();
    contributors.sort((a,b)=> new Date(a.date) - new Date(b.date));
    initObservers();
    contributors.forEach(c => grid.appendChild(renderCard(c)));
    window.addEventListener('pointerdown', kickAllVideosOnce, { once:true });
    document.addEventListener('visibilitychange', ()=> {
      if (document.visibilityState === 'visible') {
        document.querySelectorAll('video.ta-auto').forEach(v => ensureAutoplay(v));
      } else {
        document.querySelectorAll('video.ta-auto').forEach(v => { try{ v.pause(); }catch(_){ } });
      }
    });
    openItemFromQuery();
    window.addEventListener('popstate', openItemFromQuery);
  }catch(err){
    console.error('Error loading contributors:', err);
    grid.innerHTML = "<p style='text-align:center;margin:24px 0;'>Failed to load contributor list.</p>";
  }
}

function renderCard(c){
  const slug = getSlug(c);
  const card = document.createElement('article');
  card.className = 'card';
  card.id = 'art-' + slug;
  card.setAttribute('aria-label', `${c.title} by ${c.artist}`);

  const mediaWrap = document.createElement('div');
  mediaWrap.className = 'media';

  if(c.media_type === 'video'){
    const v = document.createElement('video');
    v.autoplay = true; v.muted = true; v.playsInline = true; v.loop = true;
    v.setAttribute('muted',''); v.setAttribute('playsinline','');
    v.preload = 'auto';
    if(c.poster) v.poster = c.poster;
    v.src = c.file;
    v.onerror = ()=>{ v.poster = PLACEHOLDER; };
    v.addEventListener('click', ()=>{
      history.pushState(null, '', buildItemUrl(slug));
      openLightbox('video', c.file, c.poster || '');
    });
    mediaWrap.appendChild(v);
    v.classList.add('ta-auto');
    revealObserver.observe(v);
    ioPlay.observe(v);
    v.addEventListener('loadedmetadata', ()=>ensureAutoplay(v), { once:true });
    v.addEventListener('canplay', ()=>ensureAutoplay(v));
  }else{
    const img = document.createElement('img');
    img.loading = 'lazy';
    img.alt = `${c.title} by ${c.artist}`;
    img.src = c.file;
    img.onerror = ()=>{ img.src = PLACEHOLDER; };
    img.addEventListener('click', ()=>{
      history.pushState(null, '', buildItemUrl(slug));
      openLightbox('image', c.file, '');
    });
    mediaWrap.appendChild(img);
    revealObserver.observe(img);
  }

  const metaArtist = (() => {
    if((c.artist_type||'').toLowerCase()==='x handle'){
      const clean = (c.artist||'').replace('@','');
      return `<strong>Artist:</strong> <a href="https://x.com/${clean}" target="_blank">@${clean}</a> (${c.artist_type})`;
    }
    return `<strong>Artist:</strong> ${c.artist||'Unknown'}`;
  })();

  const rowHTML = `
    <div class="row">
      <span class="chip">${c.date || ''}</span>
      <span class="spacer"></span>
      <button class="btn" type="button"
        onclick='shareItem(${JSON.stringify(JSON.stringify({slug}))})'>
        Copy Link
      </button>
      <button class="btn" type="button"
        onclick='shareItemWithTitle(${JSON.stringify(JSON.stringify({title:c.title, artist:c.artist, slug}))})'>
        Copy with Title
      </button>
    </div>
  `;

  card.innerHTML = `
    ${mediaWrap.outerHTML}
    <p class="meta">${metaArtist}</p>
    <p class="title">${c.title || 'Untitled'}</p>
    ${c.description ? `<p class="desc">${c.description}</p>` : ''}
    ${rowHTML}
  `;

  const newMedia = card.querySelector('.media');
  if(c.media_type === 'video'){
    const v2 = newMedia.querySelector('video');
    v2.addEventListener('click', ()=>{
      history.pushState(null, '', buildItemUrl(slug));
      openLightbox('video', c.file, c.poster || '');
    });
    v2.classList.add('ta-auto');
    revealObserver.observe(v2);
    ioPlay.observe(v2);
    v2.addEventListener('loadedmetadata', ()=>ensureAutoplay(v2), { once:true });
    v2.addEventListener('canplay', ()=>ensureAutoplay(v2));
  }else{
    const img2 = newMedia.querySelector('img');
    img2.addEventListener('click', ()=>{
      history.pushState(null, '', buildItemUrl(slug));
      openLightbox('image', c.file, '');
    });
    revealObserver.observe(img2);
  }
  return card;
}

function openItemFromQuery(){
  const slug = new URLSearchParams(location.search).get('item');
  if(!slug) return;
  const el = document.getElementById('art-' + slug);
  if(!el) return;
  el.scrollIntoView({ behavior:'smooth', block:'center' });
  const media = el.querySelector('img,video');
  if(media){ setTimeout(()=> media.click(), 250); }
}

function ensureAutoplay(v){
  if (!v) return;
  v.muted = true; v.setAttribute('muted',''); v.playsInline = true; v.setAttribute('playsinline','');
  const tryPlay = () => {
    const p = v.play();
    if (p && typeof p.catch === 'function') p.catch(()=>{});
  };
  tryPlay(); setTimeout(tryPlay, 150); setTimeout(tryPlay, 400);
}
function kickAllVideosOnce(){
  document.querySelectorAll('video.ta-auto').forEach(v => ensureAutoplay(v));
}

/* Updated Share: URL only */
async function shareItem(payloadStr){
  const p = JSON.parse(payloadStr); // { slug }
  const url = buildItemUrl(p.slug);
  try{
    await navigator.clipboard.writeText(url);
    alert('Link copied to clipboard.');
  }catch(e){
    console.error('Copy failed', e);
  }
}

/* Optional Share with Title for social posts */
async function shareItemWithTitle(payloadStr){
  const p = JSON.parse(payloadStr); // { title, artist, slug }
  const url = buildItemUrl(p.slug);
  const text = `${p.title} by ${p.artist} — ToadAid Contributor Art ${url}`;
  try{
    await navigator.clipboard.writeText(text);
    alert('Link + title copied to clipboard.');
  }catch(e){
    console.error('Copy failed', e);
  }
}

const lb = document.getElementById('lightbox');
const lbContent = document.getElementById('lightboxContent');
document.querySelector('#lightbox .close').addEventListener('click', closeLightbox);
lb.addEventListener('click', e => { if(e.target===lb) closeLightbox(); });
document.addEventListener('keydown', e => { if(e.key==='Escape') closeLightbox(); });

function openLightbox(kind, src, poster){
  lbContent.innerHTML = '';
  if(kind==='video'){
    const v = document.createElement('video');
    v.controls = true; v.autoplay = true; v.playsInline = true; v.muted = false;
    if(poster) v.poster = poster;
    v.src = src;
    lbContent.appendChild(v);
  }else{
    const img = document.createElement('img');
    img.src = src; img.alt = 'Preview';
    img.onerror = ()=>{ img.src = PLACEHOLDER; };
    lbContent.appendChild(img);
  }
  lb.classList.add('open');
}
function closeLightbox(){ lb.classList.remove('open'); lbContent.innerHTML = ''; }

loadContributors();
</script>
</body>
</html>
  
