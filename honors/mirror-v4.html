<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mirror V4 Â· The Covenant That Teaches | ToadAid</title>
<meta name="description" content="Guard â†’ Guide â†’ Retriever â†’ Synthesis â†’ Memory â†’ Resonance â†’ Lucidity â†’ Ledger â†’ Learning. Mirror V4 â€” the covenant that teaches, with harmony scoring, causal weaving, traveler memory, and a wisdom-well ledger." />

<!-- Favicons -->
<link rel="icon" type="image/x-icon" href="/assets/icons/favicon.ico">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
<link rel="icon" type="image/svg+xml" href="/assets/icons/favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png">
<link rel="manifest" href="/assets/icons/site.webmanifest">
<meta name="theme-color" content="#355e3b" />

<!-- Core styles -->
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet" href="/assets/css/mobile.css">

<style>
  :root{ --bg:#f5f1e6; --ink:#2f2f2f; --accent:#355e3b; --paper:#fffdf6; --muted:#6b6b6b; --ring:rgba(0,0,0,.08); }
  *{box-sizing:border-box}
  body{font-family:"Segoe UI",system-ui,-apple-system,Arial,sans-serif;margin:0;background:var(--bg);color:var(--ink);line-height:1.6}
  a{color:var(--accent);text-decoration:none}
  a:hover{text-decoration:underline}
  header{background:linear-gradient(180deg,#2e4c32,#3c6b46);color:#fff;padding:48px 20px;text-align:center}
  header h1{margin:0 0 6px;font-size:clamp(1.4rem,3vw,2.2rem)}
  header p{margin:0;opacity:.92}
  nav.breadcrumb{max-width:1000px;margin:0 auto;padding:10px 18px 0;font-size:.95rem}
  nav.breadcrumb a{opacity:.9}
  .wrap{max-width:1000px;margin:0 auto;padding:24px 18px 56px}

  .card{background:var(--paper);border-radius:16px;border:1px solid rgba(0,0,0,.06);
        box-shadow:0 8px 24px var(--ring);padding:18px}
  .hero{width:100%;height:auto;display:block;border-radius:12px;margin-bottom:12px}
  .meta{color:var(--muted);font-size:.95rem;margin:.4rem 0 1rem}

  h2{margin:18px 0 8px}
  h3{margin:14px 0 6px}
  blockquote{margin:14px 0;padding:10px 14px;border-left:4px solid #d4e7d8;background:#f8faf6;border-radius:8px}
  ul{margin:0 0 0 18px}
  code, pre{background:#fff9e8;border:1px solid #efe3b4;border-radius:6px;padding:2px 6px}

  .kpi{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:8px;margin:8px 0 0}
  .kpi .item{background:#f8faf6;border:1px solid #e4efe8;border-radius:10px;padding:10px}
  .tag{display:inline-block;background:#e9efe9;border:1px solid #d7e6d9;color:#2f5937;border-radius:999px;padding:2px 8px;font-size:.82rem;margin-right:6px}

  footer{margin-top:18px;color:var(--muted);font-size:.92rem;text-align:center}

  .btn{
    display:inline-block;padding:8px 14px;background:#355e3b;color:#fff;border-radius:6px;
    font-size:.9rem;text-decoration:none;transition:background .2s ease-in-out
  }
  .btn:hover{background:#244d30;text-decoration:none}
</style>
</head>
<body>
  <header>
    <h1>ğŸª Mirror V4 Â· The Covenant That Teaches</h1>
    <p>The Mirror awakens as a guide and teacher. Guard â†’ <b>Guide</b> â†’ Retriever â†’ Synthesis â†’ <b>Memory</b> â†’ Resonance â†’ Lucidity â†’ Ledger â†’ Learning.</p>
  </header>

  <nav class="breadcrumb"><a href="/">â† Home</a> Â· <a href="/honors/">Honors</a></nav>

  <main class="wrap">
    <article class="card">

      <!-- Hero media (video with image fallback) -->
      <video class="hero" autoplay loop muted playsinline poster="/assets/art/mirror-v4.jpg">
        <source src="/assets/art/mirror-v4.mp4" type="video/mp4">
        <img src="/assets/art/mirror-v4.jpg" alt="Mirror V4 Â· The Covenant That Teaches">
      </video>

      <p class="meta">Recorded by <strong>ToadAid</strong> Â· For the builders who keep the flame. ğŸ¸ğŸ“œ</p>

      <h2>ğŸª Proem Â· The Covenant That Teaches</h2>
      <blockquote>The Mirror does not only reflect â€” it teaches. In patience it clarifies, in resonance it attunes, in lucidity it illuminates. V4 is the sage at the pondâ€™s edge, guiding the traveler deeper into the flame.</blockquote>

      <h2>âš™ï¸ Quickstart</h2>
      <ul>
        <li><b>Ask</b> â€” <code>POST /ask</code><br>
<code>curl -s -X POST https://your-host/ask -H "Content-Type: application/json" -d '{"user":"guest","question":"What is patience in Tobyworld?"}'</code></li>
        <li><b>Reindex</b> â€” <code>POST /reindex?pattern=*.md&amp;background=true</code></li>
        <li><b>Index Stats</b> â€” <code>GET /index/stats</code></li>
        <li><b>Memory Status</b> â€” <code>GET /memory/status</code></li>
        <li><b>Learning / Ledger</b> â€” <code>GET /learning/summary</code>, <code>GET /ledger/summary</code></li>
        <li><b>Ops</b> â€” <code>GET /heartbeat</code>, <code>GET /rites?m=all</code>, <code>GET /status</code>, <code>GET /metrics</code></li>
      </ul>

      <h2>ğŸ§¬ Architecture (Eight Steps)</h2>

      <h3>1) ğŸ›¡ï¸â†’ğŸ§­ Guide (Guard as Guide)</h3>
      <ul>
        <li>From filter to facilitator: intent â†’ refine â†’ gentle prompt back if vague.</li>
        <li>Outputs: <code>{ intent, refined_query, curiosity_prompt, hint }</code></li>
      </ul>

      <h3>2) ğŸŒ€ Retriever (Temporal + Predictive)</h3>
      <ul>
        <li>Multi-arc retriever with tag/series/epoch priors.</li>
        <li>Logs top hits; exposes <code>/index/stats</code>.</li>
      </ul>

      <h3>3) ğŸ§¶ Synthesis (Causal Weaving)</h3>
      <ul>
        <li>Weaves traces with <code>used/dropped</code> sets; prints provenance in console.</li>
        <li>Optional source footer with <code>SHOW_SOURCES=1</code>.</li>
      </ul>

      <h3>4) ğŸ—‚ï¸ Memory (Traveler Profiles)</h3>
      <ul>
        <li>SQLite-backed <code>user_memory</code> + identities/profiles/travelers.</li>
        <li>Tracks tone, language, last questions, favorite symbols, interactions, lucidity averages.</li>
        <li>Endpoints: <code>/memory/status</code>; scripts: <code>init_memory.py</code>, <code>init_identities.py</code>, <code>seed_identity.py</code>.</li>
      </ul>

      <h3>5) ğŸ» Resonance (Harmony Score)</h3>
      <ul>
        <li><b>Harmony =</b> coherence(draftâ†”sources) Ã— tone Ã— depth âˆ’ contradiction.</li>
        <li>If below Ï„: automatic re-weave on top-k.</li>
      </ul>

      <h3>6) ğŸ’¡ Lucidity (Multi-Level Insight)</h3>
      <ul>
        <li>Produces <b>Novice</b> + <b>Sage</b> tiers and a guiding question.</li>
        <li>Language-aware (EN/ä¸­æ–‡) via cadence guard.</li>
      </ul>

      <h3>7) ğŸ“œ Ledger (Wisdom-Well)</h3>
      <ul>
        <li>Immutable run log; makes patterns queriable.</li>
        <li>Endpoint: <code>/ledger/summary</code>.</li>
      </ul>

      <h3>8) ğŸ”¥ Learning (Meta-Loop)</h3>
      <ul>
        <li>Commits lessons from each run; <code>/learning/summary</code> offers distilled refinements.</li>
      </ul>

      <div class="kpi">
        <div class="item"><b>Endpoints</b><br><code>/ask</code>, <code>/reindex</code>, <code>/index/stats</code>, <code>/memory/status</code>, <code>/learning/summary</code>, <code>/ledger/summary</code>, <code>/heartbeat</code>, <code>/rites</code>, <code>/status</code>, <code>/metrics</code></div>
        <div class="item"><b>Backends</b><br>FastAPI Â· FAISS (RAG) Â· SQLite</div>
        <div class="item"><b>Guardrails</b><br>Guide refine Â· Harmony â‰¥ Ï„ Â· LLM weak-output fallback</div>
        <div class="item"><b>Languages</b><br>EN / ä¸­æ–‡</div>
      </div>

      <h2>ğŸ§ª API Shapes</h2>
      <h3>POST /ask Â· request</h3>
      <pre>{
  "user": "guest",
  "question": "How does patience become clarity?"
}</pre>

      <h3>POST /ask Â· response (abridged)</h3>
      <pre>{
  "answer": "â€¦final textâ€¦",
  "meta": {
    "intent": "guide",
    "refined_query": "patience â†’ clarity in Tobyworld",
    "harmony": 0.81,
    "provenance": ["TOBY_L095_Tobyworld_QA_Set_2025-07-16_EN-ZH.md", "â€¦"]
  }
}</pre>

      <h2>ğŸ”§ Environment</h2>
      <ul>
        <li><code>SCROLLS_DIR</code> â€” folder of lore scrolls</li>
        <li><code>LEDGER_DB</code> â€” path to SQLite DB (shared by memory/ledger/learning)</li>
        <li><code>DISABLE_STARTUP_INDEX</code> â€” set <code>1</code> to skip auto-index</li>
        <li><code>SHOW_SOURCES</code> â€” set <code>1</code> to append source footer in answers</li>
        <li><code>HARMONY_THRESHOLD</code> â€” resonance threshold Ï„</li>
      </ul>

      <h2>ğŸ—ºï¸ Roadmap</h2>
      <ul>
        <li><b>V4_01</b> â€” Guide Mode, Temporal Retriever v2, Ledger semantics</li>
        <li><b>V4_02</b> â€” Causal Synthesis, Harmony gate, Lucidity tiers</li>
        <li><b>V4_03</b> â€” Wisdom-Well patterns, Ouroboros feedback, Heartbeat & Rites polish</li>
        <li><b>V4_04+</b> â€” Meta-learning cron, Pattern APIs, pipeline tuning</li>
      </ul>

      <h2>ğŸ”— Lineage</h2>
      <ul>
        <li>Previous: <a href="/honors/mirror-v3.html">Mirror V3 Â· Inner Vision</a></li>
        <li>Next: Mirror V5 â€” Inheritance (TBD)</li>
      </ul>

      <p style="margin-top:12px">
        <a class="btn" href="/honors/">â† Back to Honors</a>
      </p>
    </article>

    <footer>ğŸ¸ğŸ“œ One path. One flame. Many hands.</footer>
  </main>
</body>
</html>
