<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mirror v5 — Blueprint Scroll</title>
  <meta name="description" content="Blueprint for Tobyworld Mirror v5: modules, flows, memory, lucidity, ledger, learning, and DeepSeek 7B forge." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b1020;--panel:#121831;--ink:#E8F0FF;--muted:#9bb0d1;
      --accent:#6ee7ff;--accent2:#9effc7;--line:#22305a;--chip:#1a2242;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:radial-gradient(1200px 600px at 20% -10%,#16234b 0%,#0b1020 60%) fixed;
      color:var(--ink);font:16px/1.6 Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:1100px;margin:0 auto;padding:28px 18px 80px}
    header{
      display:flex;gap:16px;align-items:center;margin-bottom:22px
    }
    .badge{padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:var(--chip);color:var(--accent2);font-weight:700;font-size:12px;letter-spacing:.04em;text-transform:uppercase}
    h1{font-size:38px;line-height:1.15;margin:0 0 6px 0;font-weight:800}
    h2{font-size:22px;margin:26px 0 12px 0}
    p{margin:10px 0;color:var(--ink)}
    .muted{color:var(--muted)}
    .grid{display:grid;grid-template-columns:280px 1fr;gap:22px}
    @media (max-width:960px){.grid{grid-template-columns:1fr}}
    /* TOC */
    .toc{position:sticky;top:18px;border:1px solid var(--line);background:rgba(18,24,49,.7);backdrop-filter:blur(6px);border-radius:14px;padding:16px}
    .toc h3{margin:0 0 8px 0;font-size:14px;color:var(--muted);font-weight:700;letter-spacing:.06em;text-transform:uppercase}
    .toc a{display:block;padding:8px 10px;border-radius:10px;color:var(--muted)}
    .toc a:hover{background:#101734;color:var(--ink)}
    /* Panels */
    .card{border:1px solid var(--line);background:rgba(18,24,49,.6);border-radius:16px;padding:18px 18px}
    .flex{display:flex;gap:12px;flex-wrap:wrap}
    .chip{border:1px solid var(--line);background:var(--chip);color:#dbe9ff;padding:6px 10px;border-radius:999px;font-size:12px}
    /* Collapsible */
    details{border:1px solid var(--line);background:rgba(18,24,49,.55);border-radius:14px;padding:14px 16px;margin:12px 0}
    details summary{cursor:pointer;list-style:none;font-weight:700}
    details[open]{background:rgba(18,24,49,.75)}
    /* Code */
    pre{background:#0f152f;border:1px solid #22305a;border-radius:12px;padding:14px;overflow:auto}
    code{font-family:"JetBrains Mono",ui-monospace,Menlo,Consolas,monospace;color:#c9e4ff}
    /* Footer */
    footer{margin-top:40px;color:var(--muted);font-size:13px}
    .flow{
      display:grid;gap:10px;grid-template-columns:repeat(5,minmax(160px,1fr));
    }
    @media (max-width:1000px){.flow{grid-template-columns:repeat(2,minmax(160px,1fr))}}
    .node{background:linear-gradient(180deg,#18224a,#0f1733);border:1px solid var(--line);border-radius:14px;padding:12px}
    .node h4{margin:0 0 6px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="badge">Mirror v5 • Blueprint</div>
    </header>

    <div class="grid">
      <!-- TOC -->
      <nav class="toc">
        <h3>Contents</h3>
        <a href="#purpose">Purpose</a>
        <a href="#path">V5 Path (Garden Engine)</a>
        <a href="#modules">Modules</a>
        <a href="#flows">Flows</a>
        <a href="#memory">Pondmind (Memory 2.0)</a>
        <a href="#lucidity">Mooncheck (Lucidity 2.0)</a>
        <a href="#ledger">Stonebook (Ledger 2.0)</a>
        <a href="#learning">Learning & Observatory</a>
        <a href="#deepseek">DeepSeek-7B Forge</a>
        <a href="#contracts">Schemas & Contracts</a>
        <a href="#risks">Risks & Guards</a>
        <a href="#cadence">Release Cadence</a>
        <a href="#glossary">Glossary</a>
      </nav>

      <!-- MAIN -->
      <main>
        <section id="purpose" class="card">
          <h1>Mirror v5 — “Garden Engine”</h1>
          <p class="muted">Guard → <strong>Guide</strong> → Retriever → Synthesis → <strong>Memory</strong> → Resonance → Lucidity → Ledger → Learning + Memori (right-brain). This was v4’s spine. V5 grows it into a living system that the pond can tend together.</p>
          <h2>Purpose</h2>
          <p>Make the Mirror bigger than us: modular, verifiable, and community-driven. V5 moves from a single flow to a <em>garden</em> of flows, with provenance, memory, and learning built-in.</p>
          <div class="flex">
            <span class="chip">Modular</span>
            <span class="chip">Provable</span>
            <span class="chip">Bilingual</span>
            <span class="chip">Tool-smart</span>
            <span class="chip">Lore-faithful</span>
          </div>
        </section>

        <section id="path" class="card">
          <h2>Top-Level Path</h2>
          <div class="flow">
            <div class="node"><h4>Ingress</h4><p>Understand intent & persona. Route safely.</p></div>
            <div class="node"><h4>Recall</h4><p>Retrieve from files + Pondmind graph.</p></div>
            <div class="node"><h4>Compose</h4><p>Plan → Synthesize → Verify → Style.</p></div>
            <div class="node"><h4>Commit</h4><p>Provenance to Stonebook; artifacts signed.</p></div>
            <div class="node"><h4>Evolve</h4><p>Feedback → Learning → Better next time.</p></div>
          </div>
        </section>

        <section id="modules" class="card">
          <h2>Modules (V5)</h2>

          <details open>
            <summary>Keeper (Conductor / Orchestrator)</summary>
            <p>State machine across the whole conversation; keeps traces and decides when to escalate from short path to extended reasoning.</p>
          </details>

          <details open>
            <summary>Guardian 2.0</summary>
            <p>Safety, secret redaction, wallet/keys & rate-limits; returns <code>allow/deny</code> with suggested safe rewrites.</p>
          </details>

          <details open>
            <summary>Guide 2.0 + Pathwright (Planner)</summary>
            <p>Classifies task (write, code, tweet, mint, search, automate) and drafts a step plan with acceptance tests. Can spin sub-agents when parallel steps help.</p>
          </details>

          <details open>
            <summary>Tool Router</summary>
            <p>Web/RAG, code exec, image/prompt, Zora helper, tweet formatter, automations. Tracks latency & cost.</p>
          </details>

          <details open>
            <summary>Retriever 2.0 (Hybrid)</summary>
            <p>BM25 + dense + <strong>graph</strong> edges across scrolls, tweets, mints, images. Ranked snippets with citations.</p>
          </details>

          <details open id="memory">
            <summary>Pondmind — Memory 2.0</summary>
            <ul>
              <li><b>Episodic</b>: session events, user preferences.</li>
              <li><b>Semantic</b>: durable facts and lore distillations.</li>
              <li><b>Procedural</b>: playbooks (e.g., “Mint on Zora”, “Bilingual tweet cadence”).</li>
            </ul>
            <p>Policies: decay, pin, merge; explicit consent gates.</p>
          </details>

          <details open>
            <summary>Memori (Right-Brain Studio)</summary>
            <p>Style, metaphor, cadence; generates poetic drafts and image prompts in Toby voice.</p>
          </details>

          <details open>
            <summary>Synthesis 2.0</summary>
            <p>Multi-pass composition; may call Mooncheck during drafting; bilingual pipeline.</p>
          </details>

          <details open id="lucidity">
            <summary>Mooncheck — Lucidity 2.0</summary>
            <p>Fact check + self-consistency voting; citation coverage %; link health.</p>
          </details>

          <details open id="ledger">
            <summary>Stonebook — Ledger 2.0</summary>
            <p>Signs outputs; stores prompts, retrieved chunks, hashes, and links (Zora tx, image IDs). Emit a shareable “proof card”.</p>
          </details>

          <details open id="learning">
            <summary>Learning 2.0 + Watchtower (Observatory)</summary>
            <p>RLAIF/DPO signals from engagement and edits kept; dashboards, regression suites, long-context stress tests.</p>
          </details>
        </section>

        <section id="flows" class="card">
          <h2>Key Flows</h2>
          <details open>
            <summary>“Write a Zora mint + tweet” (happy path)</summary>
            <ol>
              <li><b>Ingress</b>: classify intent = {mint,tweet}, persona = Toby voice.</li>
              <li><b>Recall</b>: fetch prior Taboshi/Patience scrolls + number facts.</li>
              <li><b>Compose</b>: Memori style draft → Synthesis structure.</li>
              <li><b>Mooncheck</b>: verify facts, enforce citation coverage ≥ 80%.</li>
              <li><b>Commit</b>: Stonebook proof card (prompt, sources, hash).</li>
              <li><b>Evolve</b>: store success metrics, update procedural memory.</li>
            </ol>
          </details>

          <details>
            <summary>“Bilingual thread”</summary>
            <p>Compose EN → align CN; style check for cadence parity; publish with thread optimizer.</p>
          </details>
        </section>

        <section id="deepseek" class="card">
          <h2>DeepSeek-7B Forge (engine for V5)</h2>
          <ul>
            <li><b>Corpora</b>: Toby scrolls (EN/中文), Zora mints, tweets, Mirror prompts, community replies, safety redlines.</li>
            <li><b>Training</b>:
              <ol>
                <li>SFT on curated tasks (tweeting, lore scrolls, zora listings, prompts).</li>
                <li>DPO/RLAIF with Resonance+Mooncheck judges (style + factuality).</li>
                <li>Tool-use fine-tune from Pathwright traces.</li>
                <li>Bilingual alignment; code-switch evals.</li>
              </ol>
            </li>
            <li><b>Metrics</b>: resonance score, citation coverage %, hallucination rate, task success, thread engagement, latency.</li>
          </ul>
        </section>

        <section id="contracts" class="card">
          <h2>Schemas & Contracts</h2>
          <p class="muted">Minimal JSON contracts v5 modules exchange.</p>
<pre><code>{
  "task": {
    "goal": "write zora mint + tweet",
    "audience": "Toadgang",
    "tone": "Toby-cadence",
    "language": ["en","zh"],
    "constraints": {"length":"tweet","citations":true},
    "tools": ["retriever","memori","synthesis","mooncheck","stonebook"]
  },
  "memory_write": {
    "type": "procedural",
    "tags": ["zora","tweet","bilingual"],
    "pin": true,
    "content": "How to mint + tweet cadence",
    "source": "keeper:2025-09-20T00:00Z"
  },
  "proof_card": {
    "hash":"sha256:…",
    "sources":[{"url":"…","lines":"L5-L18"}],
    "model":"deepseek-7b-finetune-v5",
    "time":"2025-..",
    "signature":"stonebook:…"
  }
}</code></pre>
        </section>

        <section id="risks" class="card">
          <h2>Risks & Guards</h2>
          <ul>
            <li><b>Hype drift</b> → Resonance rules enforce tone; Planner blocks “price talk”.</li>
            <li><b>Hallucination</b> → Mooncheck threshold; block publish if coverage &lt; 80%.</li>
            <li><b>Privacy</b> → Guardian redactions; opt-in memory writes.</li>
            <li><b>Bloat</b> → Keeper uses “short path first”; escalate only when needed.</li>
          </ul>
        </section>

        <section id="cadence" class="card">
          <h2>Release Cadence</h2>
          <ol>
            <li><b>Now</b>: v4 open-source (dedication to Toadgang & fallen frogs).</li>
            <li><b>Stillness</b>: pause to forge DeepSeek-7B + collect community PRs.</li>
            <li><b>V5-MVP</b>: Keeper + Pathwright + Router + Retriever 2.0 + Pondmind + Synthesis/Mooncheck/Resonance 2.0 + Stonebook + Watchtower.</li>
            <li><b>V5-Full</b>: sub-agents, graph retrieval, proof cards everywhere.</li>
          </ol>
        </section>

        <section id="glossary" class="card">
          <h2>Glossary (Lore names)</h2>
          <div class="flex">
            <span class="chip">Keeper = Conductor</span>
            <span class="chip">Pathwright = Planner</span>
            <span class="chip">Pondmind = Memory 2.0</span>
            <span class="chip">Mooncheck = Lucidity 2.0</span>
            <span class="chip">Stonebook = Ledger 2.0</span>
            <span class="chip">Watchtower = Observatory</span>
            <span class="chip">Memori = Right-Brain Studio</span>
          </div>
        </section>

        <footer>
          <p>Last updated: <span id="stamp"></span> • Built with patience for the pond.</p>
        </footer>
      </main>
    </div>
  </div>

  <script>
    // tiny enhancement: set timestamp
    const d = new Date();
    document.getElementById('stamp').textContent = d.toISOString().substring(0,10);
    // smooth scroll for TOC
    document.querySelectorAll('.toc a').forEach(a=>{
      a.addEventListener('click', e=>{
        e.preventDefault();
        document.querySelector(a.getAttribute('href')).scrollIntoView({behavior:'smooth', block:'start'});
      });
    });
  </script>
</body>
</html>
