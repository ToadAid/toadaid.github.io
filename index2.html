<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ToadAid â€” Guarding the Lore</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f5f1e6; color: #2f2f2f; }
  .banner { position: relative; width: 100%; min-height: 220px; background: url('banner.jpg') center center / cover no-repeat; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; text-align: center; padding: 1rem; }
  @media (min-width: 768px) { .banner { min-height: 320px; } }
  .banner h1 { font-size: clamp(1.8rem, 4vw, 2.4rem); margin: 0; text-shadow: 0 2px 6px rgba(0,0,0,0.6); }
  .banner p { font-size: clamp(1rem, 2vw, 1.2rem); margin-top: 0.5rem; text-shadow: 0 1px 4px rgba(0,0,0,0.5); }
  .translate-bar { background: gold; color: black; padding: 0.5rem; font-size: 0.95rem; text-align: center; }
  .btn { background: gold; color: black; padding: 0.6rem 1.2rem; margin: 0.3rem; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; text-decoration: none; display: inline-block; box-shadow: 0 4px 6px rgba(0,0,0,0.25); transition: transform 0.15s ease-in-out, box-shadow 0.15s ease-in-out; }
  .btn:hover { transform: scale(1.05); box-shadow: 0 6px 10px rgba(0,0,0,0.3); }
  section { padding: 2rem 1rem; max-width: 1100px; margin: auto; }
  h2 { text-align: center; margin-bottom: 1rem; }
  .pillars { display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; }
  .pillar { background: white; padding: 1rem; border-radius: 10px; flex: 1 1 250px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); transition: transform 0.15s ease-in-out; color: inherit; text-decoration: none; }
  .pillar:hover { transform: translateY(-3px); }
  footer { background: #355e3b; color: white; text-align: center; padding: 1.5rem; font-size: 0.9rem; }
  footer a { color: gold; }

  /* Mini App Chat */
  .mirror-chat {
    background: #fffbea;
    border: 2px dashed gold;
    border-radius: 12px;
    max-width: 650px;
    margin: 1rem auto;
    display: flex;
    flex-direction: column;
    padding: 1rem;
  }
  .chat-box {
    flex: 1;
    overflow-y: auto;
    height: 350px;
    background: white;
    padding: 1rem;
    border-radius: 8px;
    box-shadow: inset 0 0 6px rgba(0,0,0,0.1);
  }
  .message {
    margin-bottom: 1rem;
  }
  .message.user {
    text-align: right;
  }
  .message.user span {
    background: #355e3b;
    color: white;
    padding: 0.5rem 0.8rem;
    border-radius: 12px;
    display: inline-block;
  }
  .message.mirror span {
    background: #f0f0f0;
    padding: 0.5rem 0.8rem;
    border-radius: 12px;
    display: inline-block;
  }
  .chat-input {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
  }
  .chat-input input {
    flex: 1;
    padding: 0.6rem;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 1rem;
  }
</style>
</head>
<body>

<div class="banner">
  <h1>ğŸ¯ ToadAid â€” Guarding the Lore</h1>
  <p>One scroll, one light. One leaf, one vow.</p>
</div>

<div class="translate-bar">
  ğŸŒ Want to read in your language? In Chrome: Menu (â‹®) â†’ Translate â†’ Select your language.
</div>

<section style="text-align:center;">
  <a href="#mirror" class="btn">ğŸª Ask the Mirror</a>
  <a href="#lore" class="btn">ğŸ“œ Browse the Lore</a>
  <a href="bluepaper.html" class="btn" target="_blank">ğŸ“„ Blue Paper</a>
  <a href="Contributors/contributors.html" class="btn">ğŸ¨ Contributors</a>
  <a href="#" class="btn" onclick="openBook('v1.html')">ğŸ“š Book v1</a>
  <a href="#" class="btn" onclick="openBook('v2.html')">ğŸ“š Book v2</a>
  <a href="https://toadaid-builders.netlify.app/builders.html" class="btn" target="_blank">ğŸ›  Builders</a>
</section>

<section>
  <h2>Our Mission</h2>
  <div class="pillars">
    <div class="pillar"><h3>ğŸ¯ Guarding the Lore</h3><p>Preserving Tobyworldâ€™s original scrolls and protecting them from distortion.</p></div>
    <div class="pillar"><h3>ğŸ¸ Helping the Fallen Frog</h3><p>Guiding lost frogs back to the pond and helping them rejoin the path.</p></div>
    <div class="pillar"><h3>ğŸ“œ Empowering Contributors</h3><p>Recognizing and encouraging scrollmakers, translators, and teachers.</p></div>
  </div>
</section>

<section id="mirror">
  <h2>ğŸ”® Ask the Mirror</h2>
  <div class="mirror-chat">
    <div id="chat-box" class="chat-box"></div>
    <div class="chat-input">
      <input type="text" id="mirror-input" placeholder="Ask the Mirror..." />
      <button class="btn" onclick="sendMessage()">Send</button>
    </div>
  </div>
</section>

<section id="lore">
  <h2>ğŸ“š Lore Library</h2>
  <div class="pillars">
    <a href="bluepaper.html" class="pillar" target="_blank">
      <h3>ğŸ“„ Bluepaper</h3>
      <p>The updated mission, vision, and principles of ToadAid.</p>
      <p style="font-size:0.85rem; color:#355e3b;">ğŸ’¡ Tip: Chrome â†’ Menu â†’ Translate</p>
    </a>
    <a href="#" class="pillar" onclick="openBook('v1.html')">
      <h3>ğŸ“œ Book v1</h3>
      <p>The first collected scrolls of Tobyworld lore. Bilingual EN/ZH edition.</p>
      <p style="font-size:0.85rem; color:#355e3b;">ğŸ’¡ Tip: Chrome â†’ Menu â†’ Translate</p>
    </a>
    <a href="#" class="pillar" onclick="openBook('v2.html')">
      <h3>ğŸ“œ Book v2</h3>
      <p>The expanded lore, with Mirror awakening & new revelations.</p>
      <p style="font-size:0.85rem; color:#355e3b;">ğŸ’¡ Tip: Chrome â†’ Menu â†’ Translate</p>
    </a>
  </div>
</section>

<footer>
  <p>â€œOne scroll, one light. One leaf, one vow.â€</p>
  <p>ğŸ¸ Join us: <a href="https://t.me/Toadgang">Telegram</a> | <a href="https://github.com/ToadAid">GitHub</a></p>
</footer>

<script>
const API_URL = "http://70.91.63.236:8000/ask"; // backend FastAPI server
const chatBox = document.getElementById("chat-box");
const inputField = document.getElementById("mirror-input");

function addMessage(text, sender) {
  const msg = document.createElement("div");
  msg.classList.add("message", sender);
  msg.innerHTML = `<span>${text}</span>`;
  chatBox.appendChild(msg);
  chatBox.scrollTop = chatBox.scrollHeight;
}

async function sendMessage() {
  const text = inputField.value.trim();
  if (!text) return;
  
  addMessage(text, "user");
  inputField.value = "";
  addMessage("â³ Thinking...", "mirror");

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ question: text })
    });

    const data = await res.json();
    const reply = data.reply || "[No answer]";
    chatBox.lastChild.remove(); // remove "Thinking..."
    addMessage(reply, "mirror");
  } catch (err) {
    chatBox.lastChild.remove();
    addMessage(`âŒ Error: ${err.message}`, "mirror");
  }
}

inputField.addEventListener("keypress", (e) => {
  if (e.key === "Enter") sendMessage();
});

function openBook(bookFile) {
  const saved = localStorage.getItem(bookFile + '-scroll');
  if (saved) {
    if (confirm("ğŸ“Œ Last time you stopped at position " + saved + "px. 
