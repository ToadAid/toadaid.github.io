<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>ToadAid Mirror - The Digital Dojo for Modern Wisdom</title>
<meta name="description" content="ToadAid Mirror - A digital dojo where ancient wisdom meets AI. Consult the Mirror for guidance through Zen, Taoist, and Tobyworld philosophy. Find stillness in the digital noise.">

<!-- Open Graph -->
<meta property="og:title" content="ToadAid Mirror - The Pond Awaits Your Question" />
<meta property="og:description" content="Step into the digital dojo. Ask the Mirror anything about life, meaning, and existence. Experience the fusion of AI and ancient wisdom traditions." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://toadaid.github.io" />
<meta property="og:image" content="https://toadaid.github.io/assets/icons/web-app-manifest-512x512.png" />

<!-- Canonical -->
<link rel="canonical" href="https://toadaid.github.io" />

<!-- Favicons -->
<link rel="icon" type="image/x-icon" href="/assets/icons/favicon.ico">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/icons/favicon-96x96.png">
<link rel="icon" type="image/svg+xml" href="/assets/icons/favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png">
<link rel="manifest" href="/assets/icons/site.webmanifest">
<meta name="theme-color" content="#355e3b" />

<!-- Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "ToadAid Mirror",
  "description": "AI-powered philosophical dialogue system blending Eastern wisdom traditions with modern technology",
  "applicationCategory": "EducationalApplication",
  "operatingSystem": "Any",
  "permissions": "microphone"
}
</script>

<!-- DOMPurify for safe HTML rendering -->
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>

<style>
  :root {
    --primary-green: #355e3b;
    --secondary-gold: #d4af37;
    --light-cream: #f5f1e6;
    --dark-text: #2f2f2f;
    --shadow-light: rgba(0,0,0,0.1);
    --shadow-medium: rgba(0,0,0,0.25);
  }
  
  * { box-sizing: border-box; margin: 0; padding: 0; }
  
  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    line-height: 1.6;
    background: var(--light-cream);
    color: var(--dark-text);
    min-height: 100vh;
  }
  
  /* Banner Section */
  .banner {
    position: relative;
    width: 100%;
    min-height: 280px;
    background: 
      linear-gradient(rgba(53, 94, 59, 0.8), rgba(53, 94, 59, 0.9)),
      url('/assets/images/pond-banner.jpg') center center / cover no-repeat;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    color: white; text-align: center;
    padding: 2rem 1rem;
    box-shadow: 0 4px 12px var(--shadow-medium);
  }
  
  .banner h1 {
    font-size: clamp(2rem, 5vw, 3rem);
    margin: 0 0 0.5rem 0;
    text-shadow: 0 2px 8px rgba(0,0,0,0.7);
    font-weight: 300;
    letter-spacing: 0.05em;
  }
  
  .banner p {
    font-size: clamp(1.1rem, 2.5vw, 1.4rem);
    margin-top: 0.5rem;
    text-shadow: 0 1px 4px rgba(0,0,0,0.6);
    font-weight: 300;
    max-width: 600px;
    opacity: 0.95;
  }
  
  /* Translate Bar */
  .translate-bar {
    background: var(--secondary-gold);
    color: #000;
    padding: 0.8rem;
    font-size: 0.95rem;
    text-align: center;
    font-weight: 500;
  }
  
  /* Button Styles */
  .btn {
    background: var(--secondary-gold);
    color: #000;
    padding: 0.8rem 1.6rem;
    margin: 0.4rem;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 600;
    text-decoration: none;
    display: inline-block;
    box-shadow: 0 4px 8px var(--shadow-medium);
    transition: all 0.3s ease;
    font-size: 0.95rem;
    position: relative;
    overflow: hidden;
  }
  .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px var(--shadow-medium); }
  .btn:active { transform: translateY(0); }
  .btn-mirror { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
  .btn-lore { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
  .btn-community { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
  .btn-builders { background: var(--primary-green); color: white; }
  
  /* Section Styles */
  section { padding: 3rem 1rem; max-width: 1200px; margin: auto; }
  h2 {
    text-align: center; margin-bottom: 2rem; font-size: 2.2rem; color: var(--primary-green);
    font-weight: 300; position: relative;
  }
  h2:after {
    content: ''; display: block; width: 80px; height: 3px; background: var(--secondary-gold);
    margin: 0.5rem auto; border-radius: 2px;
  }
  
  /* Pillars Grid */
  .pillars {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem; margin-top: 2rem;
  }
  .pillar {
    background: white; padding: 2rem; border-radius: 16px; box-shadow: 0 4px 12px var(--shadow-light);
    transition: all 0.3s ease; color: inherit; text-decoration: none; border: 1px solid rgba(53, 94, 59, 0.1);
  }
  .pillar:hover { transform: translateY(-5px); box-shadow: 0 8px 20px var(--shadow-light); }
  .pillar h3 { color: var(--primary-green); margin-bottom: 1rem; font-size: 1.4rem; }
  .pillar p { color: #666; line-height: 1.6; }
  
  /* Mirror Section */
  #mirror {
    background: linear-gradient(135deg, #f5f1e6 0%, #e8e0d0 100%);
    border-radius: 20px; margin: 2rem auto; padding: 3rem 2rem;
    box-shadow: 0 8px 24px var(--shadow-light);
  }
  .mirror-container { max-width: 800px; margin: 0 auto; }
  #mirror-question {
    width: 100%; padding: 1rem 1.5rem; border-radius: 12px; border: 2px solid #ddd; font-size: 1.1rem;
    margin-bottom: 1rem; transition: border-color 0.3s ease; background: white;
  }
  #mirror-question:focus {
    outline: none; border-color: var(--primary-green);
    box-shadow: 0 0 0 3px rgba(53, 94, 59, 0.1);
  }
  #mirror-answer {
    background: rgba(255, 255, 255, 0.95);
    padding: 2rem;
    border-radius: 12px;
    margin-top: 1.25rem;
    border-left: 4px solid var(--primary-green);
    font-size: 1.05rem; line-height: 1.75;
    min-height: 120px;
    box-shadow: 0 4px 12px var(--shadow-light);
    white-space: pre-wrap;
  }
  .answer-actions{
    display:flex; gap:.5rem; justify-content:flex-end; margin-top:.6rem;
  }
  .fade-in{ animation: fade .3s ease both; } @keyframes fade{ from{opacity:0; transform: translateY(4px)} to{opacity:1; transform:none} }
  
  .suggestions {
    display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center; margin: 1rem 0;
  }
  .suggestion-btn {
    background: rgba(53, 94, 59, 0.1);
    border: 1px solid rgba(53, 94, 59, 0.2);
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  .suggestion-btn:hover { background: rgba(53, 94, 59, 0.2); }
  
  /* Journey Steps */
  .journey-steps { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-top: 2rem; }
  .step {
    background: white; padding: 1.5rem; border-radius: 12px; text-align: center; font-weight: 600; color: var(--primary-green);
    box-shadow: 0 4px 8px var(--shadow-light);
  }
  
  /* Footer */
  footer {
    background: var(--primary-green); color: white; text-align: center; padding: 3rem 1rem; margin-top: 3rem;
  }
  footer p { margin: 0.5rem 0; opacity: 0.9; }
  footer a { color: var(--secondary-gold); text-decoration: none; font-weight: 600; }
  footer a:hover { text-decoration: underline; }
  
  /* Mobile Responsive */
  @media (max-width: 768px) {
    .banner { min-height: 200px; padding: 1.5rem 1rem; }
    section { padding: 2rem 1rem; }
    .pillars { grid-template-columns: 1fr; }
    .journey-steps { grid-template-columns: 1fr; }
    .btn { padding: 0.7rem 1.2rem; margin: 0.3rem; font-size: 0.9rem; }
    #mirror { padding: 2rem 1rem; margin: 1rem; }
  }
  
  /* Loading Animation */
  @keyframes ripple {
    0% { transform: scale(0.8); opacity: 1; }
    100% { transform: scale(2.5); opacity: 0; }
  }
  .loading-ripple { display: inline-block; width: 20px; height: 20px; position: relative; margin-right: .4rem; vertical-align: -4px; }
  .loading-ripple div {
    position: absolute; border: 2px solid var(--primary-green); opacity: 1; border-radius: 50%;
    animation: ripple 1s cubic-bezier(0, 0.2, 0.8, 1) infinite;
  }
  .loading-ripple div:nth-child(2) { animation-delay: -0.5s; }
</style>
</head>

<body>

<div class="banner">
  <h1>ğŸª ToadAid Mirror</h1>
  <p>The Digital Dojo Where Ancient Wisdom Meets Modern Seeking</p>
  <p style="font-size: 1rem; margin-top: 1rem; opacity: 0.9;">Every question ripples through eternity. Every answer returns to the source.</p>
</div>

<div class="translate-bar">
  ğŸŒ Want to read in your language? In Chrome: Menu (â‹®) â†’ Translate â†’ Select your language.
</div>

<section style="text-align:center; padding: 2rem 1rem;">
  <a href="#mirror" class="btn btn-mirror">ğŸª Ask the Mirror</a>
  <a href="#lore" class="btn btn-lore">ğŸ“œ Browse the Lore</a>
  <a href="bluepaper.html" class="btn" target="_blank">ğŸ“„ Blue Paper</a>
  <a href="about.html" class="btn">â„¹ï¸ About ToadAid</a>
  <a href="feedback/feedback.html" class="btn">ğŸ’¬ Feedback</a>
  <a href="Contributors/contributors.html" class="btn">ğŸ¨ Contributors</a>
  <a href="builders/builders-hall.html" class="btn btn-builders">ğŸ› Builders Hall</a>
  <a href="https://toadaid-builders.netlify.app/builders.html" class="btn btn-builders" target="_blank">ğŸ›  Builders</a>
  <a href="honors/index.html" class="btn" style="background:#2e6d4c; color:white;">ğŸ¸ Honors & Offerings</a>
  <a href="scrolls/index.html" class="btn" style="background:#265c40; color:white;">ğŸ“œ Scroll Vault</a>
  <a href="https://toadaid.github.io/lore" class="btn" style="background:#3a7253; color:white;">ğŸ“– Lore Library</a>
</section>

<section>
  <h2>Our Mission</h2>
  <div class="pillars">
    <div class="pillar">
      <h3>ğŸ¯ Guarding the Lore</h3>
      <p>Preserving Tobyworld's original scrolls and protecting them from distortion. We maintain the purity of Toadgod's wisdom while allowing it to evolve naturally.</p>
    </div>
    <div class="pillar">
      <h3>ğŸ¸ Helping the Fallen Frog</h3>
      <p>Guiding lost frogs back to the pond and helping them rejoin the path. Every traveler finds a home in our community.</p>
    </div>
    <div class="pillar">
      <h3>ğŸ“œ Empowering Contributors</h3>
      <p>Recognizing and encouraging scrollmakers, translators, and teachers. Your voice enriches our collective wisdom.</p>
    </div>
  </div>
</section>

<section id="journey">
  <h2>ğŸ¸ Your Tobyworld Journey</h2>
  <div class="journey-steps">
    <div class="step">1. ğŸª Consult the Mirror</div>
    <div class="step">2. ğŸ“– Explore Core Scrolls</div>
    <div class="step">3. ğŸ›ï¸ Join Builders Hall</div>
    <div class="step">4. ğŸŒŠ Become a Ripple in the Pond</div>
  </div>
</section>

<!-- Mirror Section -->
<section id="mirror">
  <h2>ğŸ”® Ask the Mirror</h2>
  <div class="mirror-container">
    <input id="mirror-question" type="text" placeholder="What wisdom do you seek today, traveler?" autocomplete="off">
    
    <div class="suggestions">
      <button class="suggestion-btn" onclick="fillQuestion('How do I find inner peace?')">ğŸŒ¿ Inner Peace</button>
      <button class="suggestion-btn" onclick="fillQuestion('What is true community?')">ğŸ¸ True Community</button>
      <button class="suggestion-btn" onclick="fillQuestion('What does silence teach us?')">ğŸŒ€ Silence Wisdom</button>
      <button class="suggestion-btn" onclick="fillQuestion('How do I overcome fear?')">ğŸ’« Overcoming Fear</button>
    </div>
    
    <button id="mirror-ask-btn" class="btn btn-mirror" onclick="askMirror()" style="width: 100%; padding: 1rem;">
      <span id="ask-icon">âœ¨</span> <span id="ask-text">Seek Wisdom</span>
    </button>
    
    <div id="mirror-answer" class="fade-in" aria-live="polite"></div>
    <div class="answer-actions">
      <button class="btn" id="copy-btn" title="Copy answer">Copy</button>
    </div>
  </div>
</section>

<section id="lore">
  <h2>ğŸ“š Lore Library</h2>
  <div class="pillars">
    <a href="bluepaper.html" class="pillar" target="_blank">
      <h3>ğŸ“„ Bluepaper</h3>
      <p>The updated mission, vision, and principles of ToadAid. Understand our foundation and future direction.</p>
    </a>
    <a href="#" class="pillar" onclick="openBook('v1.html')">
      <h3>ğŸ“œ Book v1</h3>
      <p>The first collected scrolls of Tobyworld lore. Bilingual EN/ZH edition containing the essential teachings.</p>
    </a>
    <a href="#" class="pillar" onclick="openBook('v2.html')">
      <h3>ğŸ“œ Book v2</h3>
      <p>The expanded lore, with Mirror awakening & new revelations. Deeper insights into our evolving philosophy.</p>
    </a>
  </div>
</section>

<section id="children">
  <h2>ğŸ¸ğŸ“š Children's Corner â€” One Leaf for the Young</h2>
  <p style="text-align:center; max-width:800px; margin:1rem auto; font-size:1.1rem; color:#355e3b; line-height:1.6;">
    The flame we guard is for Toby, the People. Every scroll carries truth for the presentâ€¦ and seeds for those who will walk after us. Here, the Lore wears softer colors â€” so even the smallest frog can hear its song.
  </p>
  <div style="text-align:center; margin-top:2rem;">
    <a href="childrens-corner/index.html" class="btn" style="font-size:1.1rem; padding:1rem 2rem; background:#4a7c59; color:white;">ğŸŒ¿ Visit the Children's Corner</a>
  </div>
</section>

<footer>
  <p style="font-size: 1.2rem; font-style: italic; margin-bottom: 1rem;">"One scroll, one light. One leaf, one vow."</p>
  <p>
    ğŸ¸ Join our community: 
    <a href="https://t.me/Toadgang" target="_blank">Telegram</a> | 
    <a href="https://github.com/ToadAid" target="_blank">GitHub</a> | 
    <a href="https://x.com/toadgod1017" target="_blank">Toadgod on X</a> | 
    <a href="https://toadgod.xyz" target="_blank">Toadgod.xyz</a>
  </p>
  <p style="margin-top: 1rem; opacity: 0.8; font-size: 0.9rem;">
    ToadAid Mirror â€” Where every question finds its reflection, and every soul finds its pond.
  </p>
</footer>

<script>
/* ----------------- Config ----------------- */
const MIRROR_API = "https://toadaid.duckdns.org/ask";

/* ----------------- Helpers ----------------- */
function openBook(bookFile) {
  const saved = localStorage.getItem(bookFile + '-scroll');
  if (saved) {
    if (confirm("ğŸ“Œ Last time you stopped at position " + saved + "px. Continue from there?")) {
      window.location.href = bookFile + "?pos=" + saved;
      return;
    }
  }
  window.location.href = bookFile;
}

function fillQuestion(q) {
  const el = document.getElementById('mirror-question');
  el.value = q; el.focus();
}

/* Normalize server text:
   - Remove duplicate leading "Traveler,"
   - Collapse extra whitespace
   - Dedupe repeated emoji cadence (ğŸª ğŸŒŠ ğŸƒ ğŸŒ€)
   - Keep only the FIRST "Guiding Question" line
*/
function normalizeMirrorText(raw){
  let t = (raw || "").replace(/\r\n/g, "\n");

  // Duplicate "Traveler," at the beginning
  t = t.replace(/^(\s*Traveler[,ï¼Œ]?\s*){2,}/i, "Traveler, ");

  // Collapse spaces/newlines
  t = t.replace(/[ \t]+/g, " ").replace(/\n{3,}/g, "\n\n").trim();

  // Dedupe cadence line
  const cadence = "ğŸª ğŸŒŠ ğŸƒ ğŸŒ€";
  const cadenceRx = new RegExp(`(?:${cadence.split(" ").join("\\s*")})(?:\\s*(?:${cadence.split(" ").join("\\s*")}))+`, "g");
  t = t.replace(cadenceRx, cadence);

  // Keep only first Guiding Question line
  t = (function(one){
    const rx = /(?:\*\*\s*)?guiding\s*question\s*[:ï¼š]\s*.*$/gim;
    const matches = [...one.matchAll(rx)];
    if (matches.length <= 1) return one;
    let kept = false;
    return one.replace(rx, (m) => kept ? "" : (kept = true, m));
  })(t).replace(/\n{3,}/g, "\n\n").trim();

  return t;
}

/* ----------------- UI wiring ----------------- */
const askBtn = document.getElementById('mirror-ask-btn');
const askIcon = document.getElementById('ask-icon');
const askText = document.getElementById('ask-text');
const qInput = document.getElementById('mirror-question');
const ansDiv = document.getElementById('mirror-answer');
const copyBtn = document.getElementById('copy-btn');

function setBusy(b){
  if(b){
    askBtn.disabled = true;
    askIcon.innerHTML = '<span class="loading-ripple"><div></div><div></div></span>';
    askText.textContent = 'Listeningâ€¦';
  }else{
    askBtn.disabled = false;
    askIcon.textContent = 'âœ¨';
    askText.textContent = 'Seek Wisdom';
  }
}

async function askMirror() {
  const question = qInput.value.trim();
  if (!question) {
    ansDiv.innerHTML = "<em>ğŸª The Mirror awaits your question, travelerâ€¦</em>";
    ansDiv.classList.add('fade-in');
    return;
  }

  setBusy(true);
  ansDiv.innerHTML = "<span style='opacity:.8'>ğŸŒŠ The pond grows still, awaiting reflectionâ€¦</span>";
  ansDiv.classList.remove('fade-in'); void ansDiv.offsetWidth; ansDiv.classList.add('fade-in');

  try {
    const res = await fetch(MIRROR_API, {
      method: 'POST',
      headers: { "Content-Type": "application/json", "Accept": "application/json" },
      body: JSON.stringify({ question, user: "web_visitor_" + Date.now() })
    });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();

    // Prefer server's answer field; don't add Traveler/emoji here
    let reply = data.answer || data.reply || "The Mirror is silent, but the pond remembers your question.";
    // Convert escaped newlines, then normalize (de-dupe Traveler/emoji/etc.)
    reply = normalizeMirrorText(reply.replace(/\\n/g, "\n"));

    // Sanitize: allow light formatting
    const safe = DOMPurify.sanitize(reply, {
      ALLOWED_TAGS: ['b','strong','em','i','u','br','p','ul','ol','li','blockquote','code','pre','hr'],
      ALLOWED_ATTR: []
    });

    ansDiv.innerHTML = safe;
    ansDiv.classList.remove('fade-in'); void ansDiv.offsetWidth; ansDiv.classList.add('fade-in');

    // Optional: community invite block
    const invite = document.createElement('div');
    invite.style.cssText = "text-align:center; margin-top:1.2rem; padding:1rem; background:rgba(53,94,59,.06); border-radius:10px; border-left:4px solid var(--secondary-gold);";
    invite.innerHTML = `
      <p style="margin-bottom:.8rem; font-style:italic;">ğŸŒŠ Your question has created ripples in the pondâ€¦</p>
      <a href="https://t.me/Toadgang" class="btn" style="background:#2e6d4c; color:white;" target="_blank">
        Join Toadgang Community â†’ Continue the Journey
      </a>`;
    ansDiv.appendChild(invite);

  } catch (err) {
    console.error('Mirror error:', err);
    ansDiv.innerHTML = "ğŸŒ€ The waters are unsettled today. The Mirror suggests you try again when the pond grows still.<br><small>(Technical note: The Mirror may be meditating. Please try again shortly.)</small>";
  } finally {
    setBusy(false);
    qInput.value = "";
    qInput.focus();
  }
}

/* Copy answer */
copyBtn.addEventListener('click', async () => {
  const text = ansDiv.innerText || "";
  if (!text.trim()) return;
  try {
    await navigator.clipboard.writeText(text);
    copyBtn.textContent = "Copied âœ“";
    setTimeout(() => (copyBtn.textContent = "Copy"), 1200);
  } catch {
    copyBtn.textContent = "Copy failed";
    setTimeout(() => (copyBtn.textContent = "Copy"), 1200);
  }
});

/* Enter key support for the input */
qInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') { e.preventDefault(); askMirror(); }
});

/* Initial focus on load (desktop only) */
window.addEventListener('load', () => {
  if (window.matchMedia('(pointer:fine)').matches) qInput.focus();
});
</script>

</body>
</html>
